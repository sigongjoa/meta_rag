<!DOCTYPE html>
<html>
<head>
    <title>Meta-RAG PoC</title>
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
    <h1>Meta-RAG PoC</h1>

    <div id="auth-container">
        <button id="login-button">Login with Google</button>
    </div>

    <div id="app-container" style="display: none;">
        <p>Welcome, <span id="user-email"></span>!</p>
        <button id="logout-button">Logout</button>
        <hr>
        <div class="container">
            <div class="input-area">
                <h2>Enter a math problem:</h2>
                <textarea id="problem-input" rows="5" cols="50"></textarea>
                <br>
                <button id="solve-button">Solve</button>
            </div>
            <div class="output-area">
                <h2>Retrieved Similar Problem:</h2>
                <div id="retrieved-problem" class="output-box"></div>
                <h2 style="margin-top: 20px;">Generated Thought Process:</h2>
                <div id="output" class="output-box"></div>
            </div>
        </div>
    </div>

    <script>
        const solveButton = document.getElementById("solve-button");
        const problemInput = document.getElementById("problem-input");
        const outputDiv = document.getElementById("output");
        const retrievedProblemDiv = document.getElementById("retrieved-problem");

        // Mock user login for local development
        document.getElementById("auth-container").style.display = "none";
        document.getElementById("app-container").style.display = "block";
        document.getElementById("user-email").textContent = "local-user@example.com";


        // Solve button click handler
        solveButton.addEventListener("click", async () => {
            const problemText = problemInput.value;

            if (!problemText) {
                outputDiv.innerHTML = "Please enter a problem.";
                return;
            }

            outputDiv.innerHTML = "Solving...";
            retrievedProblemDiv.innerHTML = "";

            try {
                const response = await fetch("http://127.0.0.1:8000/solve", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ problem_text: problemText })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorData.detail || response.statusText}`);
                }

                const data = await response.json();

                // Display retrieved similar problem
                if (data.retrieved_similar_problem && data.retrieved_similar_problem.id !== -1) {
                    retrievedProblemDiv.innerHTML = `<p><strong>ID:</strong> ${data.retrieved_similar_problem.id}</p><p><strong>Text:</strong> ${data.retrieved_similar_problem.text}</p>`;
                } else {
                    retrievedProblemDiv.innerHTML = "<p>No similar problem found.</p>";
                }

                // Display generated thought process
                outputDiv.innerHTML = `<p>${data.generated_thought_process}</p>`;

            } catch (error) {
                console.error("Error:", error);
                retrievedProblemDiv.innerHTML = "";
                outputDiv.innerHTML = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>